---
title: "Impacto del número de los puntos centrales en un diseño factorial completo 2^3 con una sola réplica"
format: html
editor: visual
lang: es
embed-resources: true
# bibliography: references.bib
---

Se llevaron a cabo diez mil réplicas de un diseño factorial completo $2^3$ con una sola réplica, incluyendo y omitiendo los puntos centrales, evaluándose de manera comparativa la significancia estadística de las interacciones de primer, segundo y tercer orden, y el error cuadrático medio.

```{r}
# Librerias
suppressMessages(suppressWarnings(library(kableExtra)))
```

# Significancia de los efectos

```{r}
# Número de iteraciones
n <- 10000

# Prealocar la matriz de resultados: n filas y 2 columnas
# (aquí guardaremos la media de yrta y yrta2)
TAB <- matrix(NA, nrow = n, ncol = 3)
colnames(TAB) <- c("EP", "ES", "ET")

# Bucle principal
for(i in seq_len(n)){
  # Generar variable respuesta
  
  #set.seed=123
  y <- round(rnorm(11,3,10),3)
  e <- round(rnorm(11,0,2),3)
  yrta <- y+e
  
  # Diseño de variables codificadas sin puntos centrales
  
  dis1_cod <- data.frame(
    A = c(rep(c(-1,1),4), rep(0,3)),
    B = c(rep(c(rep(-1,2), rep(1,2)), 2), rep(0,3)),
    C = c(rep(-1,4), rep(1,4), rep(0,3)), yrta)
  
  # Diseño de variables codificadas con puntos centrales
  
  dis2_cod <- dis1_cod[-c(10:11),]
  
  mod1 <- lm(yrta~A*B*C, data=dis1_cod)
  mod2 <- lm(yrta~A*B*C, data=dis2_cod)

  # efectos primarios
  EP <- sum((anova(mod1)[-(4:8),5]<=0.05)==(anova(mod2)[-(4:8),5]<=0.05))

  # efectos secundarios
  ES <- sum((anova(mod1)[c(4:6),5]<=0.05)==(anova(mod1)[c(4:6),5]<=0.05))

  # efectos terciarios
  ET <- sum((anova(mod1)[7,5]<=0.05)==(anova(mod2)[7,5]<=0.05))

  # Calcular el estadístico deseado y guardarlo
  TAB[i, ] <- c(EP,ES,ET)
}
```

```{r}
res <- round(
  data.frame(
    rbind(
      sum(TAB[,1])/(n*3)*100,  # primarios
      sum(TAB[,2])/(n*3)*100,  # interacciones dobles
      sum(TAB[,3])/(n*3)*100   # interacciones triples
    )), 2)

rownames(res) <- c("EP", "ES", "ET")
colnames(res) <- "Porcentaje"

# Crear la tabla
kable(res, 
      booktabs = TRUE, 
      align = "lccc") %>%
  kable_styling(latex_options = c("hold_position", "scale_down"))
```

```{r}
cat(
  "En el ", round(res[1,], 2),
  "% de los experimentos simulados, la inclusión de réplicas centrales no aportó a la significancia estadística de los efectos factoriales principales. 
  En el ", round(res[2,], 2),
  "% de los experimentos simulados, tampoco modificó la significancia de las interacciones de segundo orden (A:B, A:C y B:C). En el ",
  round(res[3,], 2),
  "% de los casos, la significancia de la interacción de tercer orden (A:B:C) se mantuvo sin cambios.",
  sep = "")
```

# Cuadrado Medio del Error

```{r}
# Número de repeticiones del experimento completo
n_reps <- 1000

# Número de iteraciones por experimento
n_exp <- 30

# Vector entero (0/1) para almacenar si p-valor ≤ 0.05 en cada réplica
CME <- integer(n_reps)

set.seed(123)  # Para reproducibilidad

for (j in seq_len(n_reps)) {
  # Inicializo la tabla de sigmas para este experimento
  SIGMA_tab <- data.frame(
    sigma1 = numeric(n_exp),
    sigma2 = numeric(n_exp)
  )
  
  # Bucle de los 30 experimentos
  for (i in seq_len(n_exp)) {
    # Generar variable respuesta
    y    <- round(rnorm(19, mean = 3, sd = 10), 3)
    e    <- round(rnorm(19, mean = 0, sd = 2),  3)
    yrta <- y + e
    
    # Diseño con puntos centrales
    dis1_cod <- data.frame(
      A    = c(rep(c(-1,  1),  8), rep(0, 3)),
      B    = c(rep(c(rep(-1,2), rep(1,2)), 4), rep(0, 3)),
      C    = c(rep(c(rep(-1,4), rep(1,4)), 2), rep(0, 3)),
      yrta = yrta
    )
    
    # Diseño sin puntos centrales
    dis2_cod <- dis1_cod[-(17:19), ]
    
    # Ajuste de modelos
    mod1 <- lm(yrta ~ A * B * C, data = dis1_cod)
    mod2 <- lm(yrta ~ A * B * C, data = dis2_cod)
    
    # Almaceno los residual standard errors
    SIGMA_tab$sigma1[i] <- sigma(mod1)
    SIGMA_tab$sigma2[i] <- sigma(mod2)
  }
  
  # Prueba t pareada
  prut <- t.test(
    SIGMA_tab$sigma1, SIGMA_tab$sigma2,
    paired      = TRUE,
    alternative = "two.sided",
    conf.level  = 0.95
  )
  
  # 1 si p-valor ≤ 0.05, 0 en caso contrario
  CME[j] <- as.integer(prut$p.value <= 0.05)
}
```

```{r}
cat(
  "La prueba t pareada reveló que en el",
  round(sum(CME) * 100 / n_reps, 2),
  "% de las réplicas simuladas existía una diferencia estadísticamente significativa en el error cuadrático medio."
)
```
